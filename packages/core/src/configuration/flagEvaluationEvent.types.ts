import { EvaluationContextValue } from '@openfeature/core'

export interface FlagEvaluationEvent {
  flag: {
    key: string
  }
  first_evaluation: number
  last_evaluation: number
  evaluation_count: number
  runtime_default_used: boolean
  timestamp: number
  targeting_key?: string
  error?: {
    message: string
  }
  variant?: {
    key: string
  }
  allocation?: {
    key: string
  }
  targeting_rule?: {
    key: string
  }
  service?: string
  rum?: {
    application?: {
      id?: string
    }
    view?: {
      url?: string
    }
  }
}

export interface FlagEvaluationAggregationKey {
  flagKey: string
  variantKey?: string
  allocationKey?: string
  targetingRuleKey?: string
  targetingKey?: string
  targetingContext?: Record<string, EvaluationContextValue>
}

export interface FlagEvaluationAggregationData {
  key: FlagEvaluationAggregationKey
  count: number
  firstEvaluation: number
  lastEvaluation: number
  runtimeDefaultUsed: boolean
  error?: string
}
